<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulario de Evaluaci√≥n</title>
  <link rel="stylesheet" href="css/estilos.css"/>
  <style>
    /* Layout centrado y consistente */
    body{
      margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
      background:
        linear-gradient(135deg, rgba(0,114,255,0.55), rgba(0,198,255,0.55)),
        url("fondo.avif") center center / cover no-repeat fixed;
      font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,sans-serif;color:#1f2937;
      padding:20px;
    }
    .contenedor{
      background:rgba(255,255,255,.93);backdrop-filter:blur(8px);
      border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,.25);
      width:100%;max-width:560px;padding:36px 42px;text-align:center;
    }
    h1{margin:0 0 22px;color:#0072ff;font-size:1.9rem;font-weight:700}
    .fila{display:flex;gap:12px}
    .fila > *{flex:1}
    input,textarea{
      width:100%;padding:12px 16px;margin-bottom:14px;border-radius:12px;border:1px solid #ccc;
      font-size:16px;outline:none;transition:border-color .2s, box-shadow .2s;text-align:center
    }
    input:focus,textarea:focus{border-color:#0072ff;box-shadow:0 0 6px rgba(0,114,255,.25)}
    textarea{resize:none;min-height:110px;text-align:left}
    .btn{width:100%;padding:12px;border:none;border-radius:12px;font-size:16px;font-weight:600;color:#fff;cursor:pointer;transition:background .25s}
    .btn.azul{background:#0072ff}.btn.azul:hover{background:#00c6ff}
    .btn.rojo{background:#e63946}.btn.rojo:hover{background:#ff5f5f}
    .btn.volver{background:#0072ff;margin-top:8px}
    .estado{margin-top:10px;font-weight:700}
    .estado.ok{color:#18a558}.estado.err{color:#e63946}
  </style>
</head>
<body>
  <div class="contenedor">
    <h1>üìã Formulario de Evaluaci√≥n</h1>

    <!-- Nombre -->
    <input id="nombre" type="text" placeholder="Nombre y Apellido" autocomplete="name" required />

    <!-- Calificaci√≥n: SOLO 1‚Äì10, 2 d√≠gitos m√°x -->
    <input
      id="calificacion"
      type="text"
      placeholder="Calificaci√≥n (1 a 10)"
      inputmode="numeric"
      maxlength="2"
      autocomplete="off"
    />

    <!-- Mensaje -->
    <textarea id="mensaje" placeholder="Escrib√≠ tu comentario o mensaje..." required></textarea>

    <button class="btn azul" id="btnEnviar">Enviar</button>
    <button class="btn rojo" id="btnLimpiar" type="button">Limpiar</button>
    <button class="btn volver" type="button" onclick="location.href='principal.html'">Volver</button>

    <p id="estado" class="estado"></p>
  </div>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    // Init EmailJS
    emailjs.init("x-X8iA20AVMQneCAA"); // Public Key

    // ----- Calificaci√≥n: bloqueo TOTAL -----
    const calif = document.getElementById('calificacion');

    // Sanitiza siempre que cambie (escritura/pegado/autofill)
    calif.addEventListener('input', (e) => {
      let v = e.target.value.replace(/[^0-9]/g, '').slice(0, 2); // solo d√≠gitos, m√°x 2
      // normaliza rango 1-10
      if (v.length) {
        const n = parseInt(v, 10);
        if (n === 0) v = '';        // no 0
        else if (n > 10) v = '10';  // tope
        else v = String(n);         // quita ceros a la izquierda
      }
      e.target.value = v;
    });

    // Bloqueo de teclas no num√©ricas y m√°s de 2 d√≠gitos
    calif.addEventListener('keydown', (e) => {
      const ok = ['Backspace','Delete','Tab','ArrowLeft','ArrowRight','Home','End','Enter'];
      if (ok.includes(e.key)) return;
      if (!/^\d$/.test(e.key) || calif.value.length >= 2) e.preventDefault();
    });

    // Bloquear pegado directo (igual sanitizamos en input por seguridad)
    calif.addEventListener('paste', (e) => {
      e.preventDefault();
      const text = (e.clipboardData || window.clipboardData).getData('text') || '';
      const nums = text.replace(/[^0-9]/g, '').slice(0,2);
      if (nums) calif.value = String(Math.min(parseInt(nums,10),10));
    });

    // ----- Env√≠o -----
    const estado = document.getElementById('estado');
    const nombre = document.getElementById('nombre');
    const mensaje = document.getElementById('mensaje');

    document.getElementById('btnEnviar').addEventListener('click', () => {
      const nom = nombre.value.trim();
      const cal = calif.value.trim();
      const msg = mensaje.value.trim();

      if (!nom || !cal || !msg) {
        setEstado('‚ö†Ô∏è Complet√° todos los campos.', true); return;
      }

      const n = parseInt(cal, 10);
      if (isNaN(n) || n < 1 || n > 10) {
        setEstado('‚ö†Ô∏è La calificaci√≥n debe ser un n√∫mero entre 1 y 10.', true); return;
      }

      setEstado('Enviando...', false);

      const params = { user: nom, calificacion: String(n), message: msg };

      emailjs.send("service_4i6e4ii", "template_tynh8q2", params)
        .then(() => {
          setEstado('‚úÖ Formulario enviado correctamente.', false);
          limpiar();
        })
        .catch(() => setEstado('‚ùå Error al enviar. Intentalo m√°s tarde.', true));
    });

    document.getElementById('btnLimpiar').addEventListener('click', limpiar);

    function limpiar(){
      nombre.value = '';
      calif.value = '';
      mensaje.value = '';
      setEstado('', false);
    }
    function setEstado(text, error){
      estado.textContent = text || '';
      estado.className = 'estado' + (text ? (error ? ' err' : ' ok') : '');
    }
  </script>
</body>
</html>
